# 关键文件的接口与示例

本文件给出关卡对象、词表结构与生成规则的接口与示例，供题库扩展与联调参考。

## 关卡对象（示例）

```
{
  "id": "L2-CHART-013",
  "type": "chart_fix",         // title | chart_fix | source | ethics | rumor | synthesis | speedrun
  "difficulty": "intermediate",
  "locale": ["cn","en"],
  "cn": {
    "title": "柱状图被截断且使用3D效果",
    "instruction": "通过滑杆恢复零点、关闭3D，并扩展区间到2017-2024。",
    "hints": ["注意Y轴最小值","3D会夸大视觉差异"]
  },
  "en": {
    "title": "Bar chart truncated with 3D effect",
    "instruction": "Restore zero, disable 3D, expand the window to 2017–2024.",
    "hints": ["Mind the Y-axis minimum","3D exaggerates differences"]
  },
  "assets": {
    "img": "assets/charts/bad_bar_01.png",
    "palette": "misleading"
  },
  "goals": ["restore_zero","disable_3d","expand_window"],
  "scoringWeights": {"zero":10,"no3d":10,"window":10,"deltaError":20}
}
```

说明：
- `type` 为统一枚举；内部 `category` 映射关系：
  - title → title
  - chart → chart_fix
  - source → source
  - ethics → ethics
  - rumor → rumor
  - synthesis → synthesis
  - egg → speedrun
- `goals` 与图表修正项对应：
  - zero → restore_zero
  - no3d → disable_3d
  - extend → expand_window
  - single_axis → unify_scale
  - label → fix_labels

## 词表结构

参考 `data/lexicons.json`（第6节示例），核心字段：

```
{
  "hype_words": ["震惊","唯一","颠覆",...],
  "neutral_replacements": {
    "震惊": ["引发关注","值得注意"],
    "唯一": ["较为少见"],
    ...
  },
  "fuzzy_time": ["近日","近期","去年",...],
  "ethics_flags": ["未成年人","个人隐私",...],
  "chart_risks": ["截断零点","3D失真",...]
}
```

用途：
- 伦理模块使用 `neutral_replacements` 提供中性替代表述。
- 谣言模块使用 `fuzzy_time` 与 `hype_words` 检测可疑点。
- 图表模块参考 `chart_risks` 生成提示。

## 生成规则

`dist/js/levels.engine.js` 根据难度曲线随机取种子并扰动参数生成新关，确保“可解”。要点：
- 难度曲线：`newbie/advanced/master` 分别扩大各类别数量（标题、图表、来源、伦理、谣言、综合、彩蛋），保证总数 ≥ 80。
- 扰动参数：图表类型（bar/line/pie/stacked）、`y_min`、`use_3d`、`dual_axis`、窗口区间等随机化；同时生成相应 `fixes` 列表作为解题路径。
- 可解保障：当存在截断零点/3D/双轴等风险时，必备修正项会列入 `fixes`（如 `zero/no3d/single_axis/label/extend`）。

## 接口转换（代码示例）

在 `levels.engine.js` 中提供 `toLevelSpec(internalLevel, difficulty)` 将内部关卡对象转换为上述规范结构，以便导出或联调使用：

```
import { toLevelSpec } from './levels.engine.js';
// internalLevel 来自 generateLevels() 的返回项
const spec = toLevelSpec(internalLevel, 'intermediate');
console.log(spec.type, spec.goals, spec.scoringWeights);
```

该函数自动：
- 映射 `category → type`；
- 注入中英文 `title/instruction` 与基于风险的 `hints`；
- 将 `fixes → goals`；
- 设置缺省 `scoringWeights`（可在评分模块细化）。